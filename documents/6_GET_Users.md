사용자 목록 조회 API
============

REST API에 대해 감을 잠았다면 이것을 생각하면서 본격적으로 API를 만들어 보겠습니다. 사용자에 관련된 API를 만들 것인데요 서버에 있는 사용자 목록을 조회하는 API를 만들어 볼 것입니다.


## 임시 사용자 데이터

우선 우리는 아직 데이터베이스는 다루지 않습니다. 대신에 데이터베이스 역할을 할수 있는 users 변수를 만들어서 사용하겠습니다.

```javascript
let users = [
  {
    id: 1,
    name: 'alice'
  },
  {
    id: 2,
    name: 'bek'
  },
  {
    id: 3,
    name: 'chris'
  }
]
```

let은 이전시간에 보았던 신테스죠? ES6에서 사용할 수 있는 블로스코프의 변수 입니다. let 키워드를 이용해 users 변수를 선언했구요. 선언함과 동시에 배열 값을 변수에 할당하였습니다. 이 배열을 자바스크립트 객체를 그 요소로 갖고 있는데요, id와 name을 속성으로 갖는 객체입니다. 이것은 user 객체라고 하겠습니다. user객체의 id는 객체의 식별자이고 name은 사용자의 이름을 나타내도록 하였습니다.

## 라우팅 설정

클라이언트는 이 사용자 데이터를 조회하도록 api 요청할 할수 있는데요. 이 API를 GET /users 라고 이름 짓겠습니다. 익스프레스의 라이팅 함수 중 get() 함수를 이용하여 method가 GET임을 설정한뒤 첫번재 파라매터로 경로명 /users 문자열을 설정하면 api에 대한 라우팅을 만들 수 있습니다.

```javascript
app.get('/users', (req, res) => {
  // 여기에 라우팅 로직을 작성하면 됩니다.
});
```

여기까지 작성하면 클라이언트가 GET /usres 로 요청할 경우 위에서 설정한 라우팅 함수가 동작할 것입니다. 이제 남은 것은 라우팅 함수에서 users 변수의 값을 클라이언트에 보내 주기만 하면 됩니다. 라우팅 함수의 두 파라매터중 두번 째 파라매터인 res가 응답 객체인데요, 응답객체의 함수중 json() 함수를 사용하면 json 형식의 데이터를 클라이언트에게 보내줄 수 있답니다.

## JSON

JSON은 일종의 데이터 표현 방법입니다. 프로그래밍 언어로 오해하시는 분들이 있는데 그렇지 않습니다. 인터넷에서 데이터를 주고받는 방법은 여러가지가 있는데 과거에 많이 사용하는 방법 중 하나가 XML입니다. 웹 프론트엔드 개발자라면 AJAX라는 용어에 익숙하실 거에요. Asynchronous Javascript And XML의 약자인데요 자바스크립트로 비동기 통신할때 XML를 사용한다라고 이해하시면 됩니다. 하지만 JSON이라는 또다른 표현 방법이 나왔는데 이것은 XML보다 짧은 표현으로 더 많은 정보를 표현할 수 있는 표현법이에요. 그래서 요즘에는 XML 보다는 JSON을 많이 사용하고 있답니다.

JSON의 또다른 특징은 자바스크립트 객체와 비슷한 점이 많다는 겁니다. 자바스크립트에는 객체를 자바스크립트로 변환하고 그 반대로도 할수 있는 방법이 있습니다. 익스프레스 엔진의 res.json() 함수도 자바스크립트 객체를 JSON으로 변환해 주는 기능이 내장되어 있는 것입니다.

## 라우팅 로직 작성

이점을 유념하면서 라우팅로직을 작성해 보겠습니다.

```javascript
app.get('/users', (req, res) => {
  return res.json(users);
});
```

이 코드는 좀더 단순하게 만들수 있습니다.

```javascript
app.get('/users', (req, res) => res.json(users));
```

애로우 함수는 함수 본체에 return 구문만 있을 경우 이렇게 한줄로 작성할 수 있습니다.

## API 테스트

이제 만들었으니 클라이언트에서 이 API를 요청해 보도록 하겠습니다. 처음에 다루었는 curl를 이용합니다.

```
curl -X GET '127.0.0.1:3000/users' -v
[{"id":1,"name":"chris"},{"id":2,"name":"tim"},{"id":3,"name":"daniel"}]%
```

요청한 결과 users 변수에 저장된 자바스크립트 객체가 JSON 형식으로 변환되어 클라이언트로 전달 되었습니다.
